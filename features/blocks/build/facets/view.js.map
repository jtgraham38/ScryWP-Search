{"version":3,"file":"facets/view.js","mappings":"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","sources":["webpack://scry-search-blocks/external module \"@wordpress/interactivity\"","webpack://scry-search-blocks/webpack/bootstrap","webpack://scry-search-blocks/webpack/runtime/make namespace object","webpack://scry-search-blocks/./src/facets/view.js"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Check if module exists (development only)\n\tif (__webpack_modules__[moduleId] === undefined) {\n\t\tvar e = new Error(\"Cannot find module '\" + moduleId + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { getContext, store } from '@wordpress/interactivity';\n\nconst { state } = store('scry-search/facets', {\n    state: {\n        selectedTaxonomyFacets: [],\n        get allStateText() {\n            return JSON.stringify(\n                {\n                    searchFacets: state.searchFacets,\n                },\n                null,\n                2\n            );\n        },\n    },\n    actions: {\n        handleFacetChange: (event) => {\n\n            //get context data (passed in via data-wp-context)\n            const context = getContext();\n\n            //get the taxonomy objects from the context data\n            const facetTaxonomiesObjects =\n                context?.facetTaxonomies && typeof context.facetTaxonomies === 'object'\n                    ? context.facetTaxonomies\n                    : {};\n\n            //find the taxonomy object with the same id as the event target value\n            const allTerms = Object.values(facetTaxonomiesObjects).flat();\n            const term = allTerms.find((term) => term.id == event.target.value);\n\n            //if it was checked, add its record from the facetTaxonomiesObjects array to the selectedTaxonomyFacets array\n            if (event.target.checked) {\n                if (term) {\n                    state.selectedTaxonomyFacets.push(term);\n                }\n            }\n            //if it was unchecked, remove its record from the selectedTaxonomyFacets array\n            else {\n                state.selectedTaxonomyFacets = state.selectedTaxonomyFacets.filter((facet) => facet.id !== term.id);\n            }\n        },\n        clearTaxonomyFacets: (event) => {\n\n            //get context data (passed in via data-wp-context)\n            const context = getContext();\n\n            //get the taxonomy slug from the event target value\n            const taxonomySlug = event.currentTarget.dataset.scryTaxonomySlug;\n\n            //get the taxonomy objects with the matching taxonomy slug\n            const allTerms = Object.values(context?.facetTaxonomies).flat();\n            const taxonomyObjects = allTerms.filter((term) => term.taxonomy === taxonomySlug);\n\n            //remove the taxonomy objects from the selectedTaxonomyFacets array\n            state.selectedTaxonomyFacets = state.selectedTaxonomyFacets.filter((facet) => !taxonomyObjects.includes(facet));\n\n            //uncheck all the checkboxes with the matching taxonomy slug\n            //get the nearest \"scry-facets-terms-container\" element to the current target\n            const termsContainer = event.currentTarget.closest('.scry-facets-terms-container');\n            console.log(termsContainer);\n\n            //uncheck all the checkboxes with the matching taxonomy slug\n            const checkboxes = termsContainer.querySelectorAll('input[type=\"checkbox\"]');\n            checkboxes.forEach((checkbox) => {\n                checkbox.checked = false;\n            });\n        },\n    },\n    callbacks: {\n        init() {\n\n            //get context data once while this callback has interactivity scope\n            const context = getContext();\n\n            //get the search form class from the context data\n            const searchFormClassName = context?.searchFormClassName;\n            console.log(searchFormClassName);\n\n            //seed selected state from URL-selected facets so checks persist across reloads\n            const selectedFacetIds = Array.isArray(context?.selectedFacetIds)\n                ? context.selectedFacetIds.map((id) => Number(id))\n                : [];\n            if (selectedFacetIds.length > 0 && state.selectedTaxonomyFacets.length === 0) {\n                const allTerms = Object.values(context?.facetTaxonomies ?? {}).flat();\n                state.selectedTaxonomyFacets = selectedFacetIds\n                    .map((id) => allTerms.find((term) => Number(term.id) === id))\n                    .filter(Boolean);\n            }\n\n            const bindSearchForms = () => {\n                console.log('[scry facets] init callback running');\n\n                //here, we will search the webpage for all search forms, and we will submit our facets with their contents\n                //if the searchFormClassName is set, we will filter for that too\n\n                let searchForms = Array.from(document.querySelectorAll('form'));\n                if (searchFormClassName) {\n                    searchForms = searchForms.filter((form) => {\n                        return form.classList.contains(searchFormClassName);\n                    });\n                }\n                //otherwise, we will search for all forms\n                else {\n                    searchForms = Array.from(document.querySelectorAll('form'));\n                }\n\n                //we will keep only forms that have an input of type text/search with the name \"s\"\n                searchForms = searchForms.filter((form) => {\n                    const input = form.querySelector('input[name=\"s\"]');\n                    return input && (input.type === 'text' || input.type === 'search') && form.method.toUpperCase() === 'GET';\n                });\n\n                console.log('[scry facets] eligible search forms:', searchForms.length);\n\n                //add an event listener for each search form to submit the facets with their contents\n                searchForms.forEach((form) => {\n                    if (form.dataset.scryFacetsBound === '1') {\n                        return;\n                    }\n                    form.dataset.scryFacetsBound = '1';\n\n                    form.addEventListener('submit', (event) => {\n                        event.preventDefault();\n\n                        //get the form data\n                        const formData = new FormData(form);\n\n                        //add new fields to the form data, nesting the facets under the key \"scry-search->facets\"\n                        formData.delete('scry-search[facets]');\n                        formData.delete('scry-search[facets][]');\n                        state.selectedTaxonomyFacets.forEach((facet) => {\n                            formData.append('scry-search[facets][taxonomies][]', String(facet.id));\n                        });\n\n                        //submit the form\n                        const params = new URLSearchParams(formData);\n                        window.location.assign(`${form.action}?${params.toString()}`);\n                    });\n                });\n            };\n\n            if (document.readyState === 'complete') {\n                bindSearchForms();\n            } else {\n                window.addEventListener('load', bindSearchForms, { once: true });\n            }\n        },\n    },\n});"],"names":["getContext","store","state","selectedTaxonomyFacets","allStateText","JSON","stringify","searchFacets","actions","handleFacetChange","event","context","facetTaxonomiesObjects","facetTaxonomies","allTerms","Object","values","flat","term","find","id","target","value","checked","push","filter","facet","clearTaxonomyFacets","taxonomySlug","currentTarget","dataset","scryTaxonomySlug","taxonomyObjects","taxonomy","includes","termsContainer","closest","console","log","checkboxes","querySelectorAll","forEach","checkbox","callbacks","init","searchFormClassName","selectedFacetIds","Array","isArray","map","Number","length","Boolean","bindSearchForms","searchForms","from","document","form","classList","contains","input","querySelector","type","method","toUpperCase","scryFacetsBound","addEventListener","preventDefault","formData","FormData","delete","append","String","params","URLSearchParams","window","location","assign","action","toString","readyState","once"],"sourceRoot":""}