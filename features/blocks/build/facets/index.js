(()=>{"use strict";var e,r={923(e,r,s){const t=window.wp.blocks,a=window.wp.i18n,n=window.wp.blockEditor,o=window.wp.apiFetch;var i=s.n(o);const l=window.wp.element,c=window.wp.components,d=window.ReactJSXRuntime,h=JSON.parse('{"UU":"scry-search/facets"}');(0,t.registerBlockType)(h.UU,{edit:function({attributes:e,setAttributes:r}){const{facets:s={taxonomies:{},meta:{}},searchFormClassName:t="",displayLayout:o="column",gridColumns:h=3}=e,[p,m]=(0,l.useState)({}),[y,u]=(0,l.useState)(!0),[x,f]=(0,l.useState)(""),[g,b]=(0,l.useState)({}),w=(0,n.useBlockProps)(),j=(0,n.__experimentalUseBorderProps)(e),v={...w,className:[w?.className,j?.className].filter(Boolean).join(" "),style:{...w?.style||{},...j?.style||{}}};(0,l.useEffect)(()=>{(async()=>{u(!0),f("");try{const e=await i()({path:"/scry-search/v1/blocks/facets/search-facets"});m(e?.taxonomies||{}),u(!1)}catch(e){f((0,a.__)("Failed to load taxonomies.","scry-search")),console.error("Failed to load taxonomies for facets block",e),u(!1)}})()},[]);const _=s?.taxonomies||{},C=e=>{r({facets:{taxonomies:e,meta:s?.meta||{}}})},k=Object.entries(_).filter(([,e])=>Array.isArray(e)&&e.length>0).map(([e])=>e);(0,l.useEffect)(()=>{const e={};Object.entries(_).forEach(([r,s])=>{e[r]=Array.isArray(s)?s.map(e=>e.id):[]}),b(e)},[_]);const O={display:"grid"===o?"grid":"flex",flexDirection:"row"===o?"row":"column",gridTemplateColumns:"grid"===o?`repeat(${Math.max(1,h)}, minmax(0, 1fr))`:void 0,gap:"12px"},A={marginTop:"6px",alignSelf:"flex-start",background:"transparent",color:"inherit",border:"none",padding:"2px",lineHeight:1,cursor:"pointer"};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.InspectorControls,{children:[(0,d.jsx)(c.PanelBody,{title:(0,a.__)("Facet Settings","scry-search"),initialOpen:!0,children:(0,d.jsx)(c.TextControl,{label:(0,a.__)("Search Form Class Name","scry-search"),help:(0,a.__)("Apply this filter set only to forms using this CSS class.","scry-search"),value:t,onChange:e=>r({searchFormClassName:e})})}),(0,d.jsxs)(c.PanelBody,{title:(0,a.__)("Display Options","scry-search"),initialOpen:!0,children:[(0,d.jsx)(c.SelectControl,{label:(0,a.__)("Layout","scry-search"),value:o,options:[{label:(0,a.__)("Column","scry-search"),value:"column"},{label:(0,a.__)("Row","scry-search"),value:"row"},{label:(0,a.__)("Grid","scry-search"),value:"grid"}],onChange:e=>r({displayLayout:e}),help:(0,a.__)("Choose how facet groups are arranged.","scry-search")}),"grid"===o&&(0,d.jsx)(c.RangeControl,{label:(0,a.__)("Grid Columns","scry-search"),value:h,onChange:e=>r({gridColumns:e||1}),min:2,max:6,step:1})]}),(0,d.jsxs)(c.PanelBody,{title:(0,a.__)("Taxonomies","scry-search"),initialOpen:!0,children:[y&&(0,d.jsx)(c.Spinner,{}),!!x&&(0,d.jsx)(c.Notice,{status:"error",isDismissible:!1,children:x}),!y&&!x&&0===Object.keys(p).length&&(0,d.jsx)("p",{children:(0,a.__)("No REST-enabled taxonomies with terms were found.","scry-search")}),!y&&!x&&(0,d.jsx)("p",{children:"Select the taxonomies to display in the filter set."}),!y&&!x&&Object.entries(p).map(([e,r])=>{const s=Object.prototype.hasOwnProperty.call(_,e),t=Array.isArray(_[e])?_[e]:[];return(0,d.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,d.jsx)(c.CheckboxControl,{label:`${r.label} (${e})`,checked:s,onChange:r=>((e,r)=>{const s={..._};r?Array.isArray(s[e])||(s[e]=[]):delete s[e],C(s)})(e,r)}),s&&(0,d.jsx)("div",{style:{marginLeft:"1.5rem"},children:r.terms.map(r=>{const s=t.some(e=>e?.id===r.id);return(0,d.jsx)(c.CheckboxControl,{label:`${r.name} (${r.count})`,checked:s,onChange:s=>((e,r,s)=>{const t={..._},a=Array.isArray(t[e])?[...t[e]]:[],n=a.findIndex(e=>e?.id===r.id);s&&-1===n&&a.push({id:r.id,name:r.name,slug:r.slug,taxonomy:e,count:r.count,description:r.description,link:r.link}),s||-1===n||a.splice(n,1),t[e]=a,C(t)})(e,r,s)},`${e}-${r.id}`)})})]},e)})]})]}),(0,d.jsx)("div",{children:k.length>0&&(0,d.jsx)("div",{style:O,children:k.map(e=>{const r=p[e],s=Array.isArray(_[e])?_[e]:[],t=Array.isArray(g[e])?g[e]:s.map(e=>e.id),n=r?.label||e;return(0,d.jsxs)("details",{open:!0,...v,children:[(0,d.jsx)("summary",{style:{cursor:"pointer",fontWeight:600,marginBottom:"8px"},children:`${n}`}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"6px",paddingTop:"6px"},children:[0===s.length&&(0,d.jsx)("span",{children:(0,a.__)("No terms available for this taxonomy.","scry-search")}),s.map(r=>(0,d.jsxs)("label",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,d.jsx)("input",{type:"checkbox",className:"scry-facets-preview-checkbox",checked:t.includes(r.id),onChange:s=>((e,r,s)=>{b(t=>{const a=Array.isArray(t[e])?[...t[e]]:[],n=a.includes(r);return s&&!n&&a.push(r),!s&&n?{...t,[e]:a.filter(e=>e!==r)}:{...t,[e]:a}})})(e,r.id,s.target.checked)}),(0,d.jsx)("span",{children:`${r.name} (${r.count})`})]},`preview-term-${e}-${r.id}`)),(0,d.jsx)("button",{type:"button",className:"scry-facets-preview-clear-button",style:A,onClick:()=>(e=>{b(r=>({...r,[e]:[]}))})(e),"aria-label":(0,a.__)("Clear selections","scry-search"),title:(0,a.__)("Clear selections","scry-search"),children:(0,d.jsxs)("svg",{"aria-hidden":"true",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,d.jsx)("path",{d:"M11 3H13V12.2H11V3Z",fill:"currentColor"}),(0,d.jsx)("path",{d:"M6 12.2H18L16 21H8L6 12.2Z",fill:"currentColor"}),(0,d.jsx)("path",{d:"M8.3 15.2H15.7M7.8 17.8H16.2",stroke:"white",strokeWidth:"1",strokeLinecap:"round"})]})})]})]},`preview-${e}`)})})})]})}})}},s={};function t(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={exports:{}};return r[e](n,n.exports,t),n.exports}t.m=r,e=[],t.O=(r,s,a,n)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,a,n]=e[d],i=!0,l=0;l<s.length;l++)(!1&n||o>=n)&&Object.keys(t.O).every(e=>t.O[e](s[l]))?s.splice(l--,1):(i=!1,n<o&&(o=n));if(i){e.splice(d--,1);var c=a();void 0!==c&&(r=c)}}return r}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]},t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var s in r)t.o(r,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:r[s]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e={522:0,614:0};t.O.j=r=>0===e[r];var r=(r,s)=>{var a,n,[o,i,l]=s,c=0;if(o.some(r=>0!==e[r])){for(a in i)t.o(i,a)&&(t.m[a]=i[a]);if(l)var d=l(t)}for(r&&r(s);c<o.length;c++)n=o[c],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(d)},s=globalThis.webpackChunkscry_search_blocks=globalThis.webpackChunkscry_search_blocks||[];s.forEach(r.bind(null,0)),s.push=r.bind(null,s.push.bind(s))})();var a=t.O(void 0,[614],()=>t(923));a=t.O(a)})();