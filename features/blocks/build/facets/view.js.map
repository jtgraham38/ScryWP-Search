{"version":3,"file":"facets/view.js","mappings":"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","sources":["webpack://scry-search-blocks/external module \"@wordpress/interactivity\"","webpack://scry-search-blocks/webpack/bootstrap","webpack://scry-search-blocks/webpack/runtime/make namespace object","webpack://scry-search-blocks/./src/facets/view.js"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Check if module exists (development only)\n\tif (__webpack_modules__[moduleId] === undefined) {\n\t\tvar e = new Error(\"Cannot find module '\" + moduleId + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { getContext, store } from '@wordpress/interactivity';\n\nconst { state } = store('scry-search/facets', {\n    state: {\n        selectedTaxonomyFacets: [],\n        get searchFacets() {\n            //NOTE: later, when I add meta facets, we will combing them here\n            return state.selectedTaxonomyFacets;\n\n        },\n        get allStateText() {\n            return JSON.stringify(\n                {\n                    searchFacets: state.searchFacets,\n                },\n                null,\n                2\n            );\n        },\n    },\n    actions: {\n        handleFacetChange: (event) => {\n\n            //get context data (passed in via data-wp-context)\n            const context = getContext();\n\n            //get the taxonomy objects from the context data\n            const facetTaxonomiesObjects =\n                context?.facetTaxonomies && typeof context.facetTaxonomies === 'object'\n                    ? context.facetTaxonomies\n                    : {};\n\n            //find the taxonomy object with the same id as the event target value\n            const allTerms = Object.values(facetTaxonomiesObjects).flat();\n            const term = allTerms.find((term) => term.id == event.target.value);\n\n            //if it was checked, add its record from the facetTaxonomiesObjects array to the selectedTaxonomyFacets array\n            if (event.target.checked) {\n                if (term) {\n                    state.selectedTaxonomyFacets.push(term);\n                }\n            }\n            //if it was unchecked, remove its record from the selectedTaxonomyFacets array\n            else {\n                state.selectedTaxonomyFacets = state.selectedTaxonomyFacets.filter((facet) => facet.id !== term.id);\n            }\n        },\n        clearTaxonomyFacets: (event) => {\n\n            //get context data (passed in via data-wp-context)\n            const context = getContext();\n\n            //get the taxonomy slug from the event target value\n            const taxonomySlug = event.currentTarget.dataset.scryTaxonomySlug;\n\n            //get the taxonomy objects with the matching taxonomy slug\n            const allTerms = Object.values(context?.facetTaxonomies).flat();\n            const taxonomyObjects = allTerms.filter((term) => term.taxonomy === taxonomySlug);\n\n            //remove the taxonomy objects from the selectedTaxonomyFacets array\n            state.selectedTaxonomyFacets = state.selectedTaxonomyFacets.filter((facet) => !taxonomyObjects.includes(facet));\n\n            //uncheck all the checkboxes with the matching taxonomy slug\n            //get the nearest \"scry-facets-terms-container\" element to the current target\n            const termsContainer = event.currentTarget.closest('.scry-facets-terms-container');\n            console.log(termsContainer);\n\n            //uncheck all the checkboxes with the matching taxonomy slug\n            const checkboxes = termsContainer.querySelectorAll('input[type=\"checkbox\"]');\n            checkboxes.forEach((checkbox) => {\n                checkbox.checked = false;\n            });\n        },\n    },\n    callbacks: {\n        init() {\n            const bindSearchForms = () => {\n                console.log('[scry facets] init callback running');\n\n                //here, we will search the webpage for all search forms, and we will submit our facets with their contents\n                let searchForms = Array.from(document.querySelectorAll('form'));\n\n                //we will keep only forms that have an input of type text/search with the name \"s\"\n                searchForms = searchForms.filter((form) => {\n                    const input = form.querySelector('input[name=\"s\"]');\n                    return input && (input.type === 'text' || input.type === 'search') && form.method.toUpperCase() === 'GET';\n                });\n\n                console.log('[scry facets] eligible search forms:', searchForms.length);\n\n                //add an event listener for each search form to submit the facets with their contents\n                searchForms.forEach((form) => {\n                    if (form.dataset.scryFacetsBound === '1') {\n                        return;\n                    }\n                    form.dataset.scryFacetsBound = '1';\n\n                    form.addEventListener('submit', (event) => {\n                        event.preventDefault();\n\n                        //get the form data\n                        const formData = new FormData(form);\n\n                        //add new fields to the form data, nesting the facets under the key \"scry-search->facets\"\n                        formData.delete('scry-search[facets]');\n                        formData.delete('scry-search[facets][]');\n                        state.selectedTaxonomyFacets.forEach((facet) => {\n                            console.log(facet.id);\n                            formData.append('scry-search[facets][]', String(facet.id));\n                        });\n\n                        //submit the form\n                        const params = new URLSearchParams(formData);\n                        window.location.assign(`${form.action}?${params.toString()}`);\n                    });\n                });\n            };\n\n            if (document.readyState === 'complete') {\n                bindSearchForms();\n            } else {\n                window.addEventListener('load', bindSearchForms, { once: true });\n            }\n        },\n    },\n});"],"names":["getContext","store","state","selectedTaxonomyFacets","searchFacets","allStateText","JSON","stringify","actions","handleFacetChange","event","context","facetTaxonomiesObjects","facetTaxonomies","allTerms","Object","values","flat","term","find","id","target","value","checked","push","filter","facet","clearTaxonomyFacets","taxonomySlug","currentTarget","dataset","scryTaxonomySlug","taxonomyObjects","taxonomy","includes","termsContainer","closest","console","log","checkboxes","querySelectorAll","forEach","checkbox","callbacks","init","bindSearchForms","searchForms","Array","from","document","form","input","querySelector","type","method","toUpperCase","length","scryFacetsBound","addEventListener","preventDefault","formData","FormData","delete","append","String","params","URLSearchParams","window","location","assign","action","toString","readyState","once"],"sourceRoot":""}